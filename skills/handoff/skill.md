---
name: handoff
description: Save and restore session context for seamless continuation
model: haiku
triggers:
  - handoff
  - 핸드오프
  - 인계
  - session save
  - 세션 저장
---

# DTZ Handoff Skill

세션 컨텍스트를 저장하고 복원하여 작업 연속성을 보장합니다.

## Commands

| Command | Description |
|---------|-------------|
| `/dtz:handoff` | 현재 세션 상태 저장 |
| `/dtz:handoff save [name]` | 이름 지정하여 저장 |
| `/dtz:handoff load [id]` | 특정 handoff 로드 |
| `/dtz:handoff list` | 저장된 handoff 목록 |
| `/dtz:handoff clear` | handoff 기록 정리 |
| `/dtz:handoff autoload` | autoload 상태 확인 |
| `/dtz:handoff autoload on` | autoload 활성화 |
| `/dtz:handoff autoload off` | autoload 비활성화 |

## Save Procedure

### ⚠️ CRITICAL: Timestamp Rules

> **NEVER guess or fabricate timestamps. ALWAYS execute Bash commands first.**

1. **[MANDATORY FIRST STEP] 시스템 시간 조회**

   **문서 작성 전에 반드시 아래 Bash 명령을 실행하세요:**

   ```bash
   # 1. 현재 시스템 시간 가져오기 (이 값을 Created 필드에 사용)
   date "+%Y-%m-%d %H:%M:%S"

   # 2. Session ID 생성 (이 값을 Session ID에 사용)
   echo "$(date +%Y-%m-%d)_$(openssl rand -hex 3)"
   ```

   **규칙:**
   - ❌ 절대 timestamp를 추정하거나 임의로 작성하지 마세요
   - ❌ "현재 시간이 대략..." 같은 가정 금지
   - ✅ 반드시 `date` 명령 실행 결과를 그대로 복사해서 사용
   - ✅ Bash 실행 → 결과 확인 → 그 값을 문서에 복사

2. **정보 수집**
   - TaskList로 현재 TODO 수집
   - 대화에서 주요 결정사항 추출
   - 최근 작업 파일 목록 정리

3. **문서 생성**
   - Step 1에서 가져온 **정확한 시스템 시간**을 `Created` 필드에 사용
   - Step 1에서 생성한 **정확한 Session ID**를 사용
   - 표준 템플릿으로 구성

4. **저장**
   - `.dtz/handoffs/{session-id}.md` 저장
   - `.dtz/handoffs/latest.md` 업데이트

## Load Procedure

1. **파일 읽기**
   - ID 지정 시: `.dtz/handoffs/{id}.md`
   - ID 없으면: `.dtz/handoffs/latest.md`

2. **요약 출력**
   - Session ID, 생성 날짜
   - Context 요약
   - Pending Tasks

3. **TODO 복원**
   - Pending Tasks를 TaskCreate로 생성

## Handoff Document Template

> ⚠️ `{실제_시스템_시간}`, `{실제_session_id}` 자리에는 **반드시 Bash 명령 실행 결과**를 복사해서 붙여넣으세요.

```markdown
# Session Handoff

## Meta
| Key | Value |
|-----|-------|
| Session ID | `{실제_session_id}` |
| Created | `{실제_시스템_시간}` |
| Project | `{directory name}` |

## Context Summary
{2-3문장 작업 요약}

## Completed Tasks
- [x] 완료 항목

## Pending Tasks
- [ ] 미완료 항목

## Key Decisions
| Decision | Rationale | Date |

## Important Files
| File | Description |

## Next Steps
1. 다음 할 일

---
*Generated by DTZ Handoff v2.0.5*
```

## List Procedure

저장된 handoff 목록을 표시합니다.

1. **Glob 도구 사용** (Bash 대신)
   ```
   Glob 패턴: .dtz/handoffs/*.md
   ```

2. **결과 필터링**
   - `latest.md`는 목록에서 제외 (심볼릭 링크 역할)
   - 파일명에서 Session ID 추출

3. **정보 수집**
   - 각 파일에서 Created 날짜와 Context Summary 추출
   - Read 도구로 파일 내용 읽기

4. **출력 형식**
   ```
   📋 Saved Handoffs
   ─────────────────────────────────
   1. 2025-01-30_abc123
      Created: 2025-01-30 14:30:00
      Context: API 인증 기능 구현 중...

   2. 2025-01-29_def456
      Created: 2025-01-29 18:45:00
      Context: 데이터베이스 마이그레이션...
   ─────────────────────────────────
   Total: 2 handoffs
   ```

> ⚠️ **중요**: Bash의 for loop 대신 반드시 **Glob 도구**를 사용하세요.
> zsh와 bash 간 문법 호환성 문제를 피할 수 있습니다.

## Clear Procedure

오래된 handoff 기록을 정리합니다.

1. **목록 확인**
   - Glob으로 `.dtz/handoffs/*.md` 파일 목록 조회
   - `latest.md` 제외

2. **사용자 확인**
   - 삭제할 파일 목록 표시
   - AskUserQuestion으로 확인 요청:
     - "모두 삭제" - 전체 삭제
     - "최근 N개 유지" - 최근 파일 보존
     - "취소" - 작업 취소

3. **삭제 실행**
   ```bash
   # 개별 파일 삭제 (rm 명령 사용)
   rm ".dtz/handoffs/{session-id}.md"
   ```

4. **latest.md 처리**
   - 모든 파일 삭제 시: latest.md도 삭제
   - 일부 보존 시: 가장 최근 파일로 latest.md 업데이트

## Autoload Procedure

세션 시작 시 자동 로드 기능을 설정합니다.

### autoload (상태 확인)

1. **Config 파일 읽기**
   - `.dtz/config.json` 파일 확인
   - 파일 없으면 기본값 `on` 사용

2. **상태 출력**
   ```
   📋 Handoff Autoload 설정
   ─────────────────────────────────
   상태: ✅ 활성화 (on)
   설정 파일: .dtz/config.json
   ─────────────────────────────────

   💡 변경하려면:
      /dtz:handoff autoload off  - 비활성화
      /dtz:handoff autoload on   - 활성화
   ```

### autoload on

1. **Config 파일 확인/생성**
   - `.dtz/config.json` 없으면 생성
   - 있으면 읽기

2. **설정 업데이트**
   ```json
   {
     "handoff": {
       "autoload": true
     }
   }
   ```

3. **파일 저장**
   - `.dtz/config.json`에 저장

4. **확인 메시지**
   ```
   ✅ Handoff autoload가 활성화되었습니다.
   다음 세션부터 자동으로 이전 handoff를 로드합니다.
   ```

### autoload off

1. **Config 파일 확인/생성**
   - `.dtz/config.json` 없으면 생성
   - 있으면 읽기

2. **설정 업데이트**
   ```json
   {
     "handoff": {
       "autoload": false
     }
   }
   ```

3. **파일 저장**
   - `.dtz/config.json`에 저장

4. **확인 메시지**
   ```
   ⏸️ Handoff autoload가 비활성화되었습니다.
   세션 시작 시 자동 로드가 수행되지 않습니다.
   수동 로드: /dtz:handoff load
   ```

## Auto-Load on Session Start

새 세션 시작 시 자동으로 `.dtz/handoffs/latest.md` 감지.

### 동작 조건

| 조건 | 동작 |
|------|------|
| `autoload: true` (기본값) | latest.md 감지 시 요약 정보 표시 |
| `autoload: false` | 자동 로드 건너뜀 (수동 로드만 가능) |
| 설정 파일 없음 | `autoload: true`로 동작 (기본값) |

### 설정 방법

```bash
# 자동 로드 비활성화
/dtz:handoff autoload off

# 자동 로드 활성화 (기본값)
/dtz:handoff autoload on

# 현재 상태 확인
/dtz:handoff autoload
```

> 💡 autoload가 비활성화되어 있어도 `/dtz:handoff load` 명령으로 수동 로드는 항상 가능합니다.
